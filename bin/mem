#!/bin/bash
PROCS="$(ps -eo vsz,command --no-header | awk '$1 > 0 { print $2 }'|xargs -n1 basename|sort|uniq)"
TEMPFILE=$(mktemp)
for PROC in $PROCS
do
	ps -C $PROC -o rss --no-header | \
	awk "BEGIN {S = 0} {S += \$1} END {printf \"%10.f %s\\n\", (S/1024), \"$PROC\"}" \
	>> $TEMPFILE
done
(sort -rn < $TEMPFILE) | head
rm $TEMPFILE
